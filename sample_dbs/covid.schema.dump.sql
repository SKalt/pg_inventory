--                                  Apache License
--                            Version 2.0, January 2004
--                         http://www.apache.org/licenses/
-- 
--    TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
-- 
--    1. Definitions.
-- 
--       "License" shall mean the terms and conditions for use, reproduction,
--       and distribution as defined by Sections 1 through 9 of this document.
-- 
--       "Licensor" shall mean the copyright owner or entity authorized by
--       the copyright owner that is granting the License.
-- 
--       "Legal Entity" shall mean the union of the acting entity and all
--       other entities that control, are controlled by, or are under common
--       control with that entity. For the purposes of this definition,
--       "control" means (i) the power, direct or indirect, to cause the
--       direction or management of such entity, whether by contract or
--       otherwise, or (ii) ownership of fifty percent (50%) or more of the
--       outstanding shares, or (iii) beneficial ownership of such entity.
-- 
--       "You" (or "Your") shall mean an individual or Legal Entity
--       exercising permissions granted by this License.
-- 
--       "Source" form shall mean the preferred form for making modifications,
--       including but not limited to software source code, documentation
--       source, and configuration files.
-- 
--       "Object" form shall mean any form resulting from mechanical
--       transformation or translation of a Source form, including but
--       not limited to compiled object code, generated documentation,
--       and conversions to other media types.
-- 
--       "Work" shall mean the work of authorship, whether in Source or
--       Object form, made available under the License, as indicated by a
--       copyright notice that is included in or attached to the work
--       (an example is provided in the Appendix below).
-- 
--       "Derivative Works" shall mean any work, whether in Source or Object
--       form, that is based on (or derived from) the Work and for which the
--       editorial revisions, annotations, elaborations, or other modifications
--       represent, as a whole, an original work of authorship. For the purposes
--       of this License, Derivative Works shall not include works that remain
--       separable from, or merely link (or bind by name) to the interfaces of,
--       the Work and Derivative Works thereof.
-- 
--       "Contribution" shall mean any work of authorship, including
--       the original version of the Work and any modifications or additions
--       to that Work or Derivative Works thereof, that is intentionally
--       submitted to Licensor for inclusion in the Work by the copyright owner
--       or by an individual or Legal Entity authorized to submit on behalf of
--       the copyright owner. For the purposes of this definition, "submitted"
--       means any form of electronic, verbal, or written communication sent
--       to the Licensor or its representatives, including but not limited to
--       communication on electronic mailing lists, source code control systems,
--       and issue tracking systems that are managed by, or on behalf of, the
--       Licensor for the purpose of discussing and improving the Work, but
--       excluding communication that is conspicuously marked or otherwise
--       designated in writing by the copyright owner as "Not a Contribution."
-- 
--       "Contributor" shall mean Licensor and any individual or Legal Entity
--       on behalf of whom a Contribution has been received by Licensor and
--       subsequently incorporated within the Work.
-- 
--    2. Grant of Copyright License. Subject to the terms and conditions of
--       this License, each Contributor hereby grants to You a perpetual,
--       worldwide, non-exclusive, no-charge, royalty-free, irrevocable
--       copyright license to reproduce, prepare Derivative Works of,
--       publicly display, publicly perform, sublicense, and distribute the
--       Work and such Derivative Works in Source or Object form.
-- 
--    3. Grant of Patent License. Subject to the terms and conditions of
--       this License, each Contributor hereby grants to You a perpetual,
--       worldwide, non-exclusive, no-charge, royalty-free, irrevocable
--       (except as stated in this section) patent license to make, have made,
--       use, offer to sell, sell, import, and otherwise transfer the Work,
--       where such license applies only to those patent claims licensable
--       by such Contributor that are necessarily infringed by their
--       Contribution(s) alone or by combination of their Contribution(s)
--       with the Work to which such Contribution(s) was submitted. If You
--       institute patent litigation against any entity (including a
--       cross-claim or counterclaim in a lawsuit) alleging that the Work
--       or a Contribution incorporated within the Work constitutes direct
--       or contributory patent infringement, then any patent licenses
--       granted to You under this License for that Work shall terminate
--       as of the date such litigation is filed.
-- 
--    4. Redistribution. You may reproduce and distribute copies of the
--       Work or Derivative Works thereof in any medium, with or without
--       modifications, and in Source or Object form, provided that You
--       meet the following conditions:
-- 
--       (a) You must give any other recipients of the Work or
--           Derivative Works a copy of this License; and
-- 
--       (b) You must cause any modified files to carry prominent notices
--           stating that You changed the files; and
-- 
--       (c) You must retain, in the Source form of any Derivative Works
--           that You distribute, all copyright, patent, trademark, and
--           attribution notices from the Source form of the Work,
--           excluding those notices that do not pertain to any part of
--           the Derivative Works; and
-- 
--       (d) If the Work includes a "NOTICE" text file as part of its
--           distribution, then any Derivative Works that You distribute must
--           include a readable copy of the attribution notices contained
--           within such NOTICE file, excluding those notices that do not
--           pertain to any part of the Derivative Works, in at least one
--           of the following places: within a NOTICE text file distributed
--           as part of the Derivative Works; within the Source form or
--           documentation, if provided along with the Derivative Works; or,
--           within a display generated by the Derivative Works, if and
--           wherever such third-party notices normally appear. The contents
--           of the NOTICE file are for informational purposes only and
--           do not modify the License. You may add Your own attribution
--           notices within Derivative Works that You distribute, alongside
--           or as an addendum to the NOTICE text from the Work, provided
--           that such additional attribution notices cannot be construed
--           as modifying the License.
-- 
--       You may add Your own copyright statement to Your modifications and
--       may provide additional or different license terms and conditions
--       for use, reproduction, or distribution of Your modifications, or
--       for any such Derivative Works as a whole, provided Your use,
--       reproduction, and distribution of the Work otherwise complies with
--       the conditions stated in this License.
-- 
--    5. Submission of Contributions. Unless You explicitly state otherwise,
--       any Contribution intentionally submitted for inclusion in the Work
--       by You to the Licensor shall be under the terms and conditions of
--       this License, without any additional terms or conditions.
--       Notwithstanding the above, nothing herein shall supersede or modify
--       the terms of any separate license agreement you may have executed
--       with Licensor regarding such Contributions.
-- 
--    6. Trademarks. This License does not grant permission to use the trade
--       names, trademarks, service marks, or product names of the Licensor,
--       except as required for reasonable and customary use in describing the
--       origin of the Work and reproducing the content of the NOTICE file.
-- 
--    7. Disclaimer of Warranty. Unless required by applicable law or
--       agreed to in writing, Licensor provides the Work (and each
--       Contributor provides its Contributions) on an "AS IS" BASIS,
--       WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
--       implied, including, without limitation, any warranties or conditions
--       of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
--       PARTICULAR PURPOSE. You are solely responsible for determining the
--       appropriateness of using or redistributing the Work and assume any
--       risks associated with Your exercise of permissions under this License.
-- 
--    8. Limitation of Liability. In no event and under no legal theory,
--       whether in tort (including negligence), contract, or otherwise,
--       unless required by applicable law (such as deliberate and grossly
--       negligent acts) or agreed to in writing, shall any Contributor be
--       liable to You for damages, including any direct, indirect, special,
--       incidental, or consequential damages of any character arising as a
--       result of this License or out of the use or inability to use the
--       Work (including but not limited to damages for loss of goodwill,
--       work stoppage, computer failure or malfunction, or any and all
--       other commercial damages or losses), even if such Contributor
--       has been advised of the possibility of such damages.
-- 
--    9. Accepting Warranty or Additional Liability. While redistributing
--       the Work or Derivative Works thereof, You may choose to offer,
--       and charge a fee for, acceptance of support, warranty, indemnity,
--       or other liability obligations and/or rights consistent with this
--       License. However, in accepting such obligations, You may act only
--       on Your own behalf and on Your sole responsibility, not on behalf
--       of any other Contributor, and only if You agree to indemnify,
--       defend, and hold each Contributor harmless for any liability
--       incurred by, or claims asserted against, such Contributor by reason
--       of your accepting any such warranty or additional liability.
-- 
--    END OF TERMS AND CONDITIONS
-- 
--    APPENDIX: How to apply the Apache License to your work.
-- 
--       To apply the Apache License to your work, attach the following
--       boilerplate notice, with the fields enclosed by brackets "[]"
--       replaced with your own identifying information. (Don't include
--       the brackets!)  The text should be enclosed in the appropriate
--       comment syntax for the file format. We also recommend that a
--       file or class name and description of purpose be included on the
--       same "printed page" as the copyright notice for easier
--       identification within third-party archives.
-- 
--    Copyright [yyyy] [name of copyright owner]
-- 
--    Licensed under the Apache License, Version 2.0 (the "License");
--    you may not use this file except in compliance with the License.
--    You may obtain a copy of the License at
-- 
--        http://www.apache.org/licenses/LICENSE-2.0
-- 
--    Unless required by applicable law or agreed to in writing, software
--    distributed under the License is distributed on an "AS IS" BASIS,
--    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
--    See the License for the specific language governing permissions and
--    limitations under the License.
-- 
-- --------------------------------------------------------------------------------
-- src/yb/gutil (some portions): Apache 2.0, and 3-clause BSD
-- 
-- This module is derived from code in the Chromium project, copyright
-- (c) Google inc and (c) The Chromium Authors and licensed under the
-- Apache 2.0 License or the under the 3-clause BSD license:
-- 
--   Copyright (c) 2013 The Chromium Authors. All rights reserved.
-- 
--   Redistribution and use in source and binary forms, with or without
--   modification, are permitted provided that the following conditions are
--   met:
-- 
--      * Redistributions of source code must retain the above copyright
--   notice, this list of conditions and the following disclaimer.
--      * Redistributions in binary form must reproduce the above
--   copyright notice, this list of conditions and the following disclaimer
--   in the documentation and/or other materials provided with the
--   distribution.
--      * Neither the name of Google Inc. nor the names of its
--   contributors may be used to endorse or promote products derived from
--   this software without specific prior written permission.
-- 
--   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
--   "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
--   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
--   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
--   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
--   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
--   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
--   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
--   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
--   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
--   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-- 
-- --------------------------------------------------------------------------------
-- 
-- src/yb/gutil/utf: licensed under the following terms:
-- 
--   UTF-8 Library
-- 
--   The authors of this software are Rob Pike and Ken Thompson.
--                Copyright (c) 1998-2002 by Lucent Technologies.
--   Permission to use, copy, modify, and distribute this software for any
--   purpose without fee is hereby granted, provided that this entire notice
--   is included in all copies of any software which is or includes a copy
--   or modification of this software and in all copies of the supporting
--   documentation for such software.
--   THIS SOFTWARE IS BEING PROVIDED "AS IS", WITHOUT ANY EXPRESS OR IMPLIED
--   WARRANTY.  IN PARTICULAR, NEITHER THE AUTHORS NOR LUCENT TECHNOLOGIES MAKE ANY
--   REPRESENTATION OR WARRANTY OF ANY KIND CONCERNING THE MERCHANTABILITY
--   OF THIS SOFTWARE OR ITS FITNESS FOR ANY PARTICULAR PURPOSE.
-- 
-- 
-- --------------------------------------------------------------------------------
-- 
-- src/yb/gutil/valgrind.h: Hybrid BSD (half BSD, half zlib)
-- 
--    This file is part of Valgrind, a dynamic binary instrumentation
--    framework.
-- 
--    Copyright (C) 2000-2008 Julian Seward.  All rights reserved.
-- 
--    Redistribution and use in source and binary forms, with or without
--    modification, are permitted provided that the following conditions
--    are met:
-- 
--    1. Redistributions of source code must retain the above copyright
--       notice, this list of conditions and the following disclaimer.
-- 
--    2. The origin of this software must not be misrepresented; you must
--       not claim that you wrote the original software.  If you use this
--       software in a product, an acknowledgment in the product
--       documentation would be appreciated but is not required.
-- 
--    3. Altered source versions must be plainly marked as such, and must
--       not be misrepresented as being the original software.
-- 
--    4. The name of the author may not be used to endorse or promote
--       products derived from this software without specific prior written
--       permission.
-- 
--    THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS
--    OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
--    WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
--    ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
--    DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
--    DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
--    GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
--    INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
--    WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
--    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
--    SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-- 
-- --------------------------------------------------------------------------------
-- src/yb/util (some portions): 3-clause BSD license
-- 
-- Some portions of this module are derived from code from LevelDB
-- ( https://github.com/google/leveldb ):
-- 
--   Copyright (c) 2011 The LevelDB Authors. All rights reserved.
-- 
--   Redistribution and use in source and binary forms, with or without
--   modification, are permitted provided that the following conditions are
--   met:
-- 
--      * Redistributions of source code must retain the above copyright
--   notice, this list of conditions and the following disclaimer.
--      * Redistributions in binary form must reproduce the above
--   copyright notice, this list of conditions and the following disclaimer
--   in the documentation and/or other materials provided with the
--   distribution.
--      * Neither the name of Google Inc. nor the names of its
--   contributors may be used to endorse or promote products derived from
--   this software without specific prior written permission.
-- 
--   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
--   "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
--   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
--   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
--   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
--   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
--   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
--   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
--   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
--   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
--   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-- 
-- --------------------------------------------------------------------------------
-- src/yb/util (HdrHistogram-related classes): public domain
-- 
-- Portions of these classes were ported from Java to C++ from the sources
-- available at https://github.com/HdrHistogram/HdrHistogram .
-- 
--   The code in this repository code was Written by Gil Tene, Michael Barker,
--   and Matt Warren, and released to the public domain, as explained at
--   http://creativecommons.org/publicdomain/zero/1.0/
-- 
-- --------------------------------------------------------------------------------
-- 
-- src/yb/util/random-util.cc: some portions adapted from WebRTC project
-- (modules/video_coding/main/test/test_util.cc) under a 3-clause BSD license.
-- 
--   Copyright (c) 2011, The WebRTC project authors. All rights reserved.
-- 
--   Redistribution and use in source and binary forms, with or without
--   modification, are permitted provided that the following conditions are
--   met:
-- 
--     * Redistributions of source code must retain the above copyright
--       notice, this list of conditions and the following disclaimer.
-- 
--     * Redistributions in binary form must reproduce the above copyright
--       notice, this list of conditions and the following disclaimer in
--       the documentation and/or other materials provided with the
--       distribution.
-- 
--     * Neither the name of Google nor the names of its contributors may
--       be used to endorse or promote products derived from this software
--       without specific prior written permission.
-- 
--   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
--   "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
--   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
--   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
--   HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
--   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
--   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
--   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
--   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
--   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
--   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-- 
-- --------------------------------------------------------------------------------
-- 
-- src/yb/util/sync_point: adapted from the RocksDB project under a 3-clause
-- BSD license with an additional grant of patent rights:
-- 
--   Copyright (c) 2014, Facebook, Inc.
--   All rights reserved.
-- 
--   Copyright (c) 2011 The LevelDB Authors. All rights reserved.
-- 
--   Redistribution and use in source and binary forms, with or without
--   modification, are permitted provided that the following conditions are
--   met:
-- 
--      * Redistributions of source code must retain the above copyright
--   notice, this list of conditions and the following disclaimer.
--      * Redistributions in binary form must reproduce the above
--   copyright notice, this list of conditions and the following disclaimer
--   in the documentation and/or other materials provided with the
--   distribution.
--      * Neither the name of Google Inc. nor the names of its
--   contributors may be used to endorse or promote products derived from
--   this software without specific prior written permission.
-- 
--   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
--   "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
--   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
--   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
--   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
--   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
--   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
--   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
--   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
--   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
--   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-- 
--   Additional Grant of Patent Rights Version 2
-- 
--   "Software" means the RocksDB software distributed by Facebook, Inc.
-- 
--   Facebook, Inc. ("Facebook") hereby grants to each recipient of the Software
--   ("you") a perpetual, worldwide, royalty-free, non-exclusive, irrevocable
--   (subject to the termination provision below) license under any Necessary
--   Claims, to make, have made, use, sell, offer to sell, import, and otherwise
--   transfer the Software. For avoidance of doubt, no license is granted under
--   Facebook's rights in any patent claims that are infringed by (i) modifications
--   to the Software made by you or any third party or (ii) the Software in
--   combination with any software or other technology.
-- 
--   The license granted hereunder will terminate, automatically and without notice,
--   if you (or any of your subsidiaries, corporate affiliates or agents) initiate
--   directly or indirectly, or take a direct financial interest in, any Patent
--   Assertion: (i) against Facebook or any of its subsidiaries or corporate
--   affiliates, (ii) against any party if such Patent Assertion arises in whole or
--   in part from any software, technology, product or service of Facebook or any of
--   its subsidiaries or corporate affiliates, or (iii) against any party relating
--   to the Software. Notwithstanding the foregoing, if Facebook or any of its
--   subsidiaries or corporate affiliates files a lawsuit alleging patent
--   infringement against you in the first instance, and you respond by filing a
--   patent infringement counterclaim in that lawsuit against that party that is
--   unrelated to the Software, the license granted hereunder will not terminate
--   under section (i) of this paragraph due to such counterclaim.
-- 
--   A "Necessary Claim" is a claim of a patent owned by Facebook that is
--   necessarily infringed by the Software standing alone.
-- 
--   A "Patent Assertion" is any lawsuit or other action alleging direct, indirect,
--   or contributory infringement or inducement to infringe any patent, including a
--   cross-claim or counterclaim.
-- 
-- --------------------------------------------------------------------------------
-- 
-- src/yb/server/url-coding.cc: some portions adapted from the Boost project
-- thirdparty/boost_uuid/:
-- 
--   Boost Software License - Version 1.0 - August 17th, 2003
-- 
--   Permission is hereby granted, free of charge, to any person or organization
--   obtaining a copy of the software and accompanying documentation covered by
--   this license (the "Software") to use, reproduce, display, distribute,
--   execute, and transmit the Software, and to prepare derivative works of the
--   Software, and to permit third-parties to whom the Software is furnished to
--   do so, all subject to the following:
-- 
--   The copyright notices in the Software and this entire statement, including
--   the above license grant, this restriction and the following disclaimer,
--   must be included in all copies of the Software, in whole or in part, and
--   all derivative works of the Software, unless such copies or derivative
--   works are solely in the form of machine-executable object code generated by
--   a source language processor.
-- 
--   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
--   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
--   FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
--   SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
--   FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
--   ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
--   DEALINGS IN THE SOFTWARE.
-- 
-- --------------------------------------------------------------------------------
-- 
-- www/bootstrap: Apache 2.0 license
-- 
--    Copyright 2012 Twitter, Inc
-- 
--    Licensed under the Apache License, Version 2.0 (the "License");
--    you may not use this file except in compliance with the License.
--    You may obtain a copy of the License at
-- 
--        http://www.apache.org/licenses/LICENSE-2.0
-- 
--    Unless required by applicable law or agreed to in writing, software
--    distributed under the License is distributed on an "AS IS" BASIS,
--    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
--    See the License for the specific language governing permissions and
--    limitations under the License.
-- 
-- --------------------------------------------------------------------------------
-- 
-- www/d3.v2.js: BSD 3-clause license
-- 
--    Copyright (c) 2012, Michael Bostock
--    All rights reserved.
-- 
--    Redistribution and use in source and binary forms, with or without
--    modification, are permitted provided that the following conditions are met:
-- 
--    * Redistributions of source code must retain the above copyright notice, this
--    list of conditions and the following disclaimer.
-- 
--    * Redistributions in binary form must reproduce the above copyright notice,
--    this list of conditions and the following disclaimer in the documentation
--    and/or other materials provided with the distribution.
-- 
--    * The name Michael Bostock may not be used to endorse or promote products
--    derived from this software without specific prior written permission.
-- 
--    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
--    AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
--    IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
--    DISCLAIMED. IN NO EVENT SHALL MICHAEL BOSTOCK BE LIABLE FOR ANY DIRECT,
--    INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
--    BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
--    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
--    OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
--    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
--    EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-- --------------------------------------------------------------------------------
-- 
-- www/epoch.*: MIT license
-- 
--   Copyright (c) 2014 Fastly, Inc.
-- 
--   Permission is hereby granted, free of charge, to any person obtaining a copy
--   of this software and associated documentation files (the "Software"), to deal
--   in the Software without restriction, including without limitation the rights
--   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
--   copies of the Software, and to permit persons to whom the Software is
--   furnished to do so, subject to the following conditions:
-- 
--   The above copyright notice and this permission notice shall be included in
--   all copies or substantial portions of the Software.
-- 
--   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
--   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
--   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
--   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
--   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
--   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
--   THE SOFTWARE.
-- 
-- --------------------------------------------------------------------------------
-- 
-- www/jquery*.js: MIT license
-- 
--   Copyright 2005, 2014 jQuery Foundation and other contributors,
--   https://jquery.org/
-- 
--   This software consists of voluntary contributions made by many
--   individuals. For exact contribution history, see the revision history
--   available at https://github.com/jquery/jquery
-- 
--   Permission is hereby granted, free of charge, to any person obtaining
--   a copy of this software and associated documentation files (the
--   "Software"), to deal in the Software without restriction, including
--   without limitation the rights to use, copy, modify, merge, publish,
--   distribute, sublicense, and/or sell copies of the Software, and to
--   permit persons to whom the Software is furnished to do so, subject to
--   the following conditions:
-- 
--   The above copyright notice and this permission notice shall be
--   included in all copies or substantial portions of the Software.
-- 
--   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
--   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
--   MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
--   NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
--   LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
--   OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
--   WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-- 
-- --------------------------------------------------------------------------------
-- 
-- java/yb-client/src/main/java/org/ybdb/util/: Slice.java and Slices.java
-- 
--   Derived from the LevelDB Java project at https://github.com/dain/leveldb/
--   Licensed under the Apache 2.0 license with the following copyrights:
-- 
--   Copyright 2011 Dain Sundstrom <dain@iq80.com>
--   Copyright 2011 FuseSource Corp. http://fusesource.com
-- 
--   Licensed under the Apache License, Version 2.0 (the "License");
--   you may not use this file except in compliance with the License.
--   You may obtain a copy of the License at
-- 
--       http://www.apache.org/licenses/LICENSE-2.0
-- 
--   Unless required by applicable law or agreed to in writing, software
--   distributed under the License is distributed on an "AS IS" BASIS,
--   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
--   See the License for the specific language governing permissions and
--   limitations under the License.
-- 
-- --------------------------------------------------------------------------------
-- 
-- java/yb-client/: Some classes are derived from the AsyncHBase project
-- under the following 3-clause BSD license:
-- 
--   Copyright (C) 2010-2012  The Async HBase Authors.  All rights reserved.
--   This file is part of Async HBase.
-- 
--   Redistribution and use in source and binary forms, with or without
--   modification, are permitted provided that the following conditions are met:
--     - Redistributions of source code must retain the above copyright notice,
--       this list of conditions and the following disclaimer.
--     - Redistributions in binary form must reproduce the above copyright notice,
--       this list of conditions and the following disclaimer in the documentation
--       and/or other materials provided with the distribution.
--     - Neither the name of the StumbleUpon nor the names of its contributors
--       may be used to endorse or promote products derived from this software
--       without specific prior written permission.
--   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
--   AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
--   IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
--   ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
--   LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
--   CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
--   SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
--   INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
--   CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
--   ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
--   POSSIBILITY OF SUCH DAMAGE.
-- 
-- --------------------------------------------------------------------------------
-- 
-- .ycm_extra_conf.py: public domain
-- 
--   This is free and unencumbered software released into the public domain.
-- 
--   Anyone is free to copy, modify, publish, use, compile, sell, or
--   distribute this software, either in source code form or as a compiled
--   binary, for any purpose, commercial or non-commercial, and by any
--   means.
-- 
--   In jurisdictions that recognize copyright laws, the author or authors
--   of this software dedicate any and all copyright interest in the
--   software to the public domain. We make this dedication for the benefit
--   of the public at large and to the detriment of our heirs and
--   successors. We intend this dedication to be an overt act of
--   relinquishment in perpetuity of all present and future rights to this
--   software under copyright law.
-- 
--   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
--   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
--   MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
--   IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR
--   OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
--   ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
--   OTHER DEALINGS IN THE SOFTWARE.
-- 
--   For more information, please refer to <http://unlicense.org/>
-- 
-- ================================================================================
-- 
-- Note on thirdparty dependencies downloaded during the build process
-- -------------------------------------------------------------------
-- The YugaByte build process downloads many thirdparty dependencies automatically.
-- Please refer to thirdparty/LICENSE.txt for relevant information.
---- END LICENSE ----
--
-- PostgreSQL database cluster dump
--

SET default_transaction_read_only = off;

SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;

--
-- Roles
--

ALTER ROLE postgres WITH SUPERUSER INHERIT CREATEROLE CREATEDB LOGIN REPLICATION BYPASSRLS;






--
-- Databases
--

--
-- Database "template1" dump
--

\connect template1

--
-- PostgreSQL database dump
--

-- Dumped from database version 14.0
-- Dumped by pg_dump version 14.3 (Ubuntu 14.3-1.pgdg20.04+1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- PostgreSQL database dump complete
--

--
-- Database "postgres" dump
--

\connect postgres

--
-- PostgreSQL database dump
--

-- Dumped from database version 14.0
-- Dumped by pg_dump version 14.3 (Ubuntu 14.3-1.pgdg20.04+1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: assert_assumptions_ok(date, date); Type: PROCEDURE; Schema: public; Owner: postgres
--

CREATE PROCEDURE public.assert_assumptions_ok(IN start_survey_date date, IN end_survey_date date)
    LANGUAGE plpgsql
    AS $_$
declare
  -- Each survey date (i.e. "time_value") has exactly the same number of states (i.e. "geo_value").
  -- Each state has the same number, of survey date values.

  expected_states constant text[] not null := array[
    'ak', 'al', 'ar', 'az', 'ca', 'co', 'ct', 'dc', 'de', 'fl', 'ga',
    'hi', 'ia', 'id', 'il', 'in', 'ks', 'ky', 'la', 'ma', 'md',
    'me', 'mi', 'mn', 'mo', 'ms', 'mt', 'nc', 'nd', 'ne', 'nh',
    'nj', 'nm', 'nv', 'ny', 'oh', 'ok', 'or', 'pa', 'ri', 'sc',
    'sd', 'tn', 'tx', 'ut', 'va', 'vt', 'wa', 'wi', 'wv', 'wy'
  ];

  expected_state_count constant int := cardinality(expected_states);

  actual_states_qry constant text not null :=
    'select array_agg(distinct geo_value order by geo_value) from ?';

  actual_states text[] not null := '{}';

  expected_dates date[] not null := array[start_survey_date];

  actual_dates_qry constant text not null :=
    'select array_agg(distinct time_value order by time_value) from ?';

  actual_dates date[] not null := '{}';

  expected_date_count int not null := 0;

  names constant covidcast_names[] not null := (
    select array_agg((csv_file, staging_table, signal)::covidcast_names) from covidcast_names);

  expected_total_count int not null := 0;

  r covidcast_names not null := ('', '', '');
  d  date     not null := start_survey_date;
  t  text     not null := '';
  n  int      not null := 0;
  b  boolean  not null := false;
begin
  loop
    d := d + interval '1 day';
    expected_dates := expected_dates||d;
    exit when d >= end_survey_date;
  end loop;
  expected_date_count := cardinality(expected_dates);
  expected_total_count := expected_state_count*expected_date_count;

  foreach r in array names loop

    -- signal: One of covidcast_names.signal.
    execute replace('select distinct signal from ?', '?', r.staging_table) into t;
    assert t = r.signal, 'signal from '||r.staging_table||' <> "'||r.signal||'"';

    -- geo_type: state.
    execute 'select distinct geo_type from '||r.staging_table into t;
    assert t = 'state', 'geo_type from '||r.staging_table||' <> "state"';

    -- data_source: fb-survey.
    execute 'select distinct data_source from '||r.staging_table into t;
    assert t = 'fb-survey', 'data_source from '||r.staging_table||' <> "fb-survey"';

    -- direction: IS NULL.
    execute $$select distinct coalesce(direction, '<null>') from $$||r.staging_table into t;
    assert t = '<null>', 'direction from '||r.staging_table||' <> "<null>"';

    -- Expected total count(*).
    execute 'select count(*) from '||r.staging_table into n;
    assert n = expected_total_count, 'count from '||r.staging_table||' <> expected_total_count';

    -- geo_value: Check list of actual distinct states is as expected.
    execute replace(actual_states_qry, '?', r.staging_table) into actual_states;
    assert actual_states = expected_states, 'actual_states <> expected_states';

    -- geo_value: Expected distinct state (i.e. "geo_value") count(*).
    execute 'select count(distinct geo_value) from '||r.staging_table into n;
    assert n = expected_state_count, 'distinct state count per survey date from '||r.staging_table||' <> expected_state_count';

    -- time_value: Check list of actual distinct survey dates is as expected.
    execute replace(actual_dates_qry, '?', r.staging_table) into actual_dates;
    assert actual_dates = expected_dates, 'actual_dates <> expected_dates';

    -- time_value: Expected distinct survey date (i.e. "time_value") count(*).
    execute 'select count(distinct time_value) from '||r.staging_table into n;
    assert n = expected_date_count, 'distinct survey date count per state from '||r.staging_table||' <> expected_date_count';

    -- Same number of states (i.e. "geo_value") for each distinct survey date (i.e. "time_value").
    execute '
      with r as (
        select time_value, count(time_value) as n from '||r.staging_table||'
        group by time_value)
      select distinct n from r' into n;
    assert n = expected_state_count, 'distinct state count from '||r.staging_table||' <> expected_state_count';

    -- Same number of survey dates (i.e. "time_value") for each distinct state (i.e. geo_value).
    execute '
      with r as (
        select geo_value, count(geo_value) as n from '||r.staging_table||'
        group by geo_value)
      select distinct n from r' into n;
    assert n = expected_date_count, 'distinct state count from '||r.staging_table||' <> expected_date_count';

    -- value: check is legal percentage value.
    execute '
      select
        max(value) between 0 and 100 and
        min(value) between 0 and 100
      from '||r.staging_table into b;
    assert b, 'max(value), min(value) from '||r.staging_table||' both < 100 FALSE';
  end loop;

  -- code and geo_value: check same exact one-to-one correspondence in all staging tables.
  declare
    chk_code_and_geo_values constant text := $$
    with
      a1 as (
        select to_char(code, '90')||' '||geo_value as v from ?1),
      v1 as (
        select v, count(v) as n from a1 group by v),
      a2 as (
        select to_char(code, '90')||' '||geo_value as v from ?2),
      v2 as (
        select v, count(v) as n from a2 group by v),
      a3 as (
        select to_char(code, '90')||' '||geo_value as v from ?3),
      v3 as (
        select v, count(v) as n from a3 group by v),

      v4 as (select v, n from v1 except select v, n from v2),
      v5 as (select v, n from v2 except select v, n from v1),
      v6 as (select v, n from v1 except select v, n from v3),
      v7 as (select v, n from v3 except select v, n from v1),

      r as (
        select v, n from v4
        union all
        select v, n from v5
        union all
        select v, n from v6
        union all
        select v, n from v6)

    select count(*) from r$$;
  begin
    execute replace(replace(replace(chk_code_and_geo_values, 
    '?1', names[1].staging_table),
    '?2', names[2].staging_table),
    '?3', names[3].staging_table
    ) into n;

    assert n = 0, '(code, geo_value) tuples from the three staging tables disagree';
  end;

  -- Check set of (geo_value, time_value) values same in each staging table.
  declare
    chk_putative_pks constant text := '
      with
        v1 as (
          select geo_value, time_value from ?1
          except
          select geo_value, time_value from ?2),

        v2 as (
          select geo_value, time_value from ?2
          except
          select geo_value, time_value from ?1),

        v3 as (
          select geo_value, time_value from ?1
          except
          select geo_value, time_value from ?3),

        v4 as (
          select geo_value, time_value from ?3
          except
          select geo_value, time_value from ?1),

        v5 as (
          select geo_value, time_value from v1
          union all
          select geo_value, time_value from v2
          union all
          select geo_value, time_value from v3
          union all
          select geo_value, time_value from v4)

      select count(*) from v5';
  begin
    execute replace(replace(replace(chk_putative_pks,
        '?1', names[1].staging_table),
        '?2', names[2].staging_table),
        '?3', names[3].staging_table)
      into n;

    assert n = 0, 'pk values from ' ||
      replace(replace(replace('?1, ?2, ?3',
        '?1', names[1].staging_table),
        '?2', names[2].staging_table),
        '?3', names[3].staging_table) ||
      ' do not line up';
  end;
end;
$_$;


ALTER PROCEDURE public.assert_assumptions_ok(IN start_survey_date date, IN end_survey_date date) OWNER TO postgres;

--
-- Name: cr_copy_from_scripts(integer); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.cr_copy_from_scripts(which integer) RETURNS text
    LANGUAGE plpgsql
    AS $_$
<<b>>declare
  copy_from_csv constant text :=
    $$\copy ?1 from '?2' with (format 'csv', header true);$$;

  csv_file       text not null := '';
  staging_table  text not null := '';
begin
  with a as (
    select
      row_number() over (order by s.csv_file) as r,
      s.csv_file,
      s.staging_table
    from covidcast_names as s)
  select a.csv_file, a.staging_table
  into b.csv_file, b.staging_table
  from a where a.r = which;

  return replace(replace(
    copy_from_csv,
    '?1',
    staging_table),
    '?2',
    csv_file);
end b;
$_$;


ALTER FUNCTION public.cr_copy_from_scripts(which integer) OWNER TO postgres;

--
-- Name: cr_staging_tables(); Type: PROCEDURE; Schema: public; Owner: postgres
--

CREATE PROCEDURE public.cr_staging_tables()
    LANGUAGE plpgsql
    AS $$
declare
  drop_table constant text := '
    drop table if exists ? cascade;                               ';

  create_staging_table constant text := '
    create table ?(
      code         int     not null,
      geo_value    text    not null,
      signal       text    not null,
      time_value   date    not null,
      direction    text,
      issue        date    not null,
      lag          int     not null,
      value        numeric not null,
      stderr       numeric not null,
      sample_size  numeric not null,
      geo_type     text    not null,
      data_source  text    not null,
      constraint ?_pk primary key(geo_value, time_value));
    ';

  names constant text[] not null := (
    select array_agg(staging_table) from covidcast_names);
  name text not null := '';
begin
  foreach name in array names loop
    execute replace(drop_table, '?',name);

    execute replace(create_staging_table, '?',name);
  end loop;
end;
$$;


ALTER PROCEDURE public.cr_staging_tables() OWNER TO postgres;

--
-- Name: populate_t(integer, double precision, double precision, double precision, double precision); Type: PROCEDURE; Schema: public; Owner: postgres
--

CREATE PROCEDURE public.populate_t(IN no_of_rows integer, IN slope double precision, IN intercept double precision, IN mean double precision, IN stddev double precision)
    LANGUAGE plpgsql
    AS $$
begin
  delete from t;

  with
    a1 as (
      select
        s.v        as k,
        s.v        as x,
        (s.v * slope) + intercept as y
      from generate_series(1, no_of_rows) as s(v)),

    a2 as (
      select (
        row_number() over()) as k,
        r.v as delta
      from normal_rand(no_of_rows, mean, stddev) as r(v))

  insert into t(k, x, y, delta)
  select
    k, x, a1.y, a2.delta
  from a1 inner join a2 using(k);

  insert into t(k, x, y, delta) values
    (no_of_rows + 1,    0, null, null),
    (no_of_rows + 2, null,    0, null);
end;
$$;


ALTER PROCEDURE public.populate_t(IN no_of_rows integer, IN slope double precision, IN intercept double precision, IN mean double precision, IN stddev double precision) OWNER TO postgres;

--
-- Name: xform_to_covidcast_fb_survey_results(); Type: PROCEDURE; Schema: public; Owner: postgres
--

CREATE PROCEDURE public.xform_to_covidcast_fb_survey_results()
    LANGUAGE plpgsql
    AS $$
declare
  -- Check that the staging tables have the expected names for their roles.
  -- Each subquery assignemnt will fail if doesn't return exactly one row.
  mask_wearers_name    text not null := (select staging_table from covidcast_names where staging_table = 'mask_wearers');
  symptoms_name        text not null := (select staging_table from covidcast_names where staging_table = 'symptoms');
  cmnty_symptoms_name  text not null := (select staging_table from covidcast_names where staging_table = 'cmnty_symptoms');

  stmt text not null := '
    insert into covidcast_fb_survey_results(
      survey_date, state,
      mask_wearing_pct,    mask_wearing_stderr,    mask_wearing_sample_size,
      symptoms_pct,        symptoms_stderr,        symptoms_sample_size,
      cmnty_symptoms_pct,  cmnty_symptoms_stderr,  cmnty_symptoms_sample_size)
    select
      time_value, geo_value,
      m.value, m.stderr, round(m.sample_size),
      s.value, s.stderr, round(s.sample_size),
      c.value, c.stderr, round(c.sample_size)
    from
      ?1 as m
      inner join ?2 as s using (time_value, geo_value)
      inner join ?3 as c using (time_value, geo_value)';

begin
  drop table if exists covidcast_fb_survey_results cascade;

  create table covidcast_fb_survey_results(
    survey_date                 date     not null,
    state                       text     not null,
    mask_wearing_pct            numeric  not null,
    mask_wearing_stderr         numeric  not null,
    mask_wearing_sample_size    int      not null,
    symptoms_pct                numeric  not null,
    symptoms_stderr             numeric  not null,
    symptoms_sample_size        int      not null,
    cmnty_symptoms_pct          numeric  not null,
    cmnty_symptoms_stderr       numeric  not null,
    cmnty_symptoms_sample_size  int      not null,

    constraint covidcast_fb_survey_results_pk primary key (state, survey_date),

    constraint covidcast_fb_survey_results_chk_mask_wearing_pct    check(mask_wearing_pct   between 0 and 100),
    constraint covidcast_fb_survey_results_chk_symptoms_pct        check(symptoms_pct       between 0 and 100),
    constraint covidcast_fb_survey_results_chk_cmnty_symptoms_pct  check(cmnty_symptoms_pct between 0 and 100),

    constraint covidcast_fb_survey_results_chk_mask_wearing_stderr    check(mask_wearing_stderr   > 0),
    constraint covidcast_fb_survey_results_chk_symptoms_stderr        check(symptoms_stderr       > 0),
    constraint covidcast_fb_survey_results_chk_cmnty_symptoms_stderr  check(cmnty_symptoms_stderr > 0),

    constraint covidcast_fb_survey_results_chk_mask_wearing_sample_size    check(mask_wearing_sample_size   > 0),
    constraint covidcast_fb_survey_results_chk_symptoms_sample_size        check(symptoms_sample_size       > 0),
    constraint covidcast_fb_survey_results_chk_cmnty_symptoms_sample_size  check(cmnty_symptoms_sample_size > 0)
  );

  execute replace(replace(replace(stmt,
    '?1', mask_wearers_name),
    '?2', symptoms_name),
    '?3', cmnty_symptoms_name);
end;
$$;


ALTER PROCEDURE public.xform_to_covidcast_fb_survey_results() OWNER TO postgres;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: cmnty_symptoms; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.cmnty_symptoms (
    code integer NOT NULL,
    geo_value text NOT NULL,
    signal text NOT NULL,
    time_value date NOT NULL,
    direction text,
    issue date NOT NULL,
    lag integer NOT NULL,
    value numeric NOT NULL,
    stderr numeric NOT NULL,
    sample_size numeric NOT NULL,
    geo_type text NOT NULL,
    data_source text NOT NULL
);


ALTER TABLE public.cmnty_symptoms OWNER TO postgres;

--
-- Name: covidcast_fb_survey_results; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.covidcast_fb_survey_results (
    survey_date date NOT NULL,
    state text NOT NULL,
    mask_wearing_pct numeric NOT NULL,
    mask_wearing_stderr numeric NOT NULL,
    mask_wearing_sample_size integer NOT NULL,
    symptoms_pct numeric NOT NULL,
    symptoms_stderr numeric NOT NULL,
    symptoms_sample_size integer NOT NULL,
    cmnty_symptoms_pct numeric NOT NULL,
    cmnty_symptoms_stderr numeric NOT NULL,
    cmnty_symptoms_sample_size integer NOT NULL,
    CONSTRAINT covidcast_fb_survey_results_chk_cmnty_symptoms_pct CHECK (((cmnty_symptoms_pct >= (0)::numeric) AND (cmnty_symptoms_pct <= (100)::numeric))),
    CONSTRAINT covidcast_fb_survey_results_chk_cmnty_symptoms_sample_size CHECK ((cmnty_symptoms_sample_size > 0)),
    CONSTRAINT covidcast_fb_survey_results_chk_cmnty_symptoms_stderr CHECK ((cmnty_symptoms_stderr > (0)::numeric)),
    CONSTRAINT covidcast_fb_survey_results_chk_mask_wearing_pct CHECK (((mask_wearing_pct >= (0)::numeric) AND (mask_wearing_pct <= (100)::numeric))),
    CONSTRAINT covidcast_fb_survey_results_chk_mask_wearing_sample_size CHECK ((mask_wearing_sample_size > 0)),
    CONSTRAINT covidcast_fb_survey_results_chk_mask_wearing_stderr CHECK ((mask_wearing_stderr > (0)::numeric)),
    CONSTRAINT covidcast_fb_survey_results_chk_symptoms_pct CHECK (((symptoms_pct >= (0)::numeric) AND (symptoms_pct <= (100)::numeric))),
    CONSTRAINT covidcast_fb_survey_results_chk_symptoms_sample_size CHECK ((symptoms_sample_size > 0)),
    CONSTRAINT covidcast_fb_survey_results_chk_symptoms_stderr CHECK ((symptoms_stderr > (0)::numeric))
);


ALTER TABLE public.covidcast_fb_survey_results OWNER TO postgres;

--
-- Name: covidcast_fb_survey_results_v; Type: VIEW; Schema: public; Owner: postgres
--

CREATE VIEW public.covidcast_fb_survey_results_v AS
 SELECT covidcast_fb_survey_results.survey_date,
    covidcast_fb_survey_results.state,
    covidcast_fb_survey_results.mask_wearing_pct,
    covidcast_fb_survey_results.cmnty_symptoms_pct AS symptoms_pct
   FROM public.covidcast_fb_survey_results;


ALTER TABLE public.covidcast_fb_survey_results_v OWNER TO postgres;

--
-- Name: covidcast_names; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.covidcast_names (
    csv_file text NOT NULL,
    staging_table text NOT NULL,
    signal text NOT NULL
);


ALTER TABLE public.covidcast_names OWNER TO postgres;

--
-- Name: mask_wearers; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.mask_wearers (
    code integer NOT NULL,
    geo_value text NOT NULL,
    signal text NOT NULL,
    time_value date NOT NULL,
    direction text,
    issue date NOT NULL,
    lag integer NOT NULL,
    value numeric NOT NULL,
    stderr numeric NOT NULL,
    sample_size numeric NOT NULL,
    geo_type text NOT NULL,
    data_source text NOT NULL
);


ALTER TABLE public.mask_wearers OWNER TO postgres;

--
-- Name: symptoms; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.symptoms (
    code integer NOT NULL,
    geo_value text NOT NULL,
    signal text NOT NULL,
    time_value date NOT NULL,
    direction text,
    issue date NOT NULL,
    lag integer NOT NULL,
    value numeric NOT NULL,
    stderr numeric NOT NULL,
    sample_size numeric NOT NULL,
    geo_type text NOT NULL,
    data_source text NOT NULL
);


ALTER TABLE public.symptoms OWNER TO postgres;

--
-- Name: t; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.t (
    k integer NOT NULL,
    x double precision,
    y double precision,
    delta double precision
);


ALTER TABLE public.t OWNER TO postgres;

--
-- Name: cmnty_symptoms cmnty_symptoms_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.cmnty_symptoms
    ADD CONSTRAINT cmnty_symptoms_pk PRIMARY KEY (geo_value, time_value);


--
-- Name: covidcast_fb_survey_results covidcast_fb_survey_results_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.covidcast_fb_survey_results
    ADD CONSTRAINT covidcast_fb_survey_results_pk PRIMARY KEY (state, survey_date);


--
-- Name: covidcast_names covidcast_names_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.covidcast_names
    ADD CONSTRAINT covidcast_names_pkey PRIMARY KEY (csv_file);


--
-- Name: mask_wearers mask_wearers_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.mask_wearers
    ADD CONSTRAINT mask_wearers_pk PRIMARY KEY (geo_value, time_value);


--
-- Name: symptoms symptoms_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.symptoms
    ADD CONSTRAINT symptoms_pk PRIMARY KEY (geo_value, time_value);


--
-- Name: t t_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.t
    ADD CONSTRAINT t_pkey PRIMARY KEY (k);


--
-- Name: covidcast_names_signal_unq; Type: INDEX; Schema: public; Owner: postgres
--

CREATE UNIQUE INDEX covidcast_names_signal_unq ON public.covidcast_names USING btree (signal);


--
-- Name: covidcast_names_staging_table_unq; Type: INDEX; Schema: public; Owner: postgres
--

CREATE UNIQUE INDEX covidcast_names_staging_table_unq ON public.covidcast_names USING btree (staging_table);


--
-- PostgreSQL database dump complete
--

--
-- PostgreSQL database cluster dump complete
--

